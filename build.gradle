import com.github.jk1.license.render.TextReportRenderer

plugins {
    id 'com.github.jk1.dependency-license-report' version '1.6'
}

licenseReport {
    outputDir = "$projectDir/build/licenses"

    renderers = [new TextReportRenderer("THIRD-PARTY-LICENSES.txt")]

}

allprojects {

    repositories {
        mavenCentral()
        maven {
            name 'Nexus@NT'
            url "http://repository.novatec-gmbh.de/content/repositories/3rd_party_libs/"
        }
    }
    apply plugin: 'jacoco'

    if (!project.hasProperty('buildVersion') || project.getProperty('buildVersion').empty) {
        ext.buildVersion = 'SNAPSHOT'
    }

    version = "$buildVersion"
}


task codeCoverageReport(type: JacocoReport) {
    group = 'Verification'
    description = 'Generates a combined report from all subprojects'

    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    subprojects.each {
        if(it.plugins.hasPlugin('java')) {
            sourceSets it.sourceSets.main
            dependsOn it.test
        }
    }

    reports {
        xml.enabled true
        xml.destination file("${buildDir}/reports/jacoco/report.xml")
        html.enabled true
        html.destination file("${buildDir}/reports/jacoco/html")
        csv.enabled false
    }
}
codeCoverageReport.dependsOn {
    project(':inspectit-ocelot-agent').systemTest
}